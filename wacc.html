<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WACC 计算器</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app">
    <header class="header">
        <h1>📊 WACC 加权平均资本成本计算器</h1>
        <a href="index.html" class="nav-button">返回DCF计算器</a>
    </header>

    <main class="container">
        <!-- 参数输入区域（统一白色背景） -->
        <div class="unified-input-section">
            <!-- 公共参数区域 -->
            <div class="parameter-block">
                <h2>🔧 公共参数</h2>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label for="incomeBeforeTax">利润总额（万元）</label>
                        <input type="number" id="incomeBeforeTax" v-model.number="incomeBeforeTax" placeholder="请输入利润总额">
                    </div>

                    <div class="input-group">
                        <label for="incomeTax">所得税费用（万元）</label>
                        <input type="number" id="incomeTax" v-model.number="incomeTax" placeholder="请输入所得税费用">
                    </div>

                    <div class="input-group">
                        <label for="interestBearingDebt" title="短期借款、一年内到期的非流动负债、长期借款、应付债券之和">有息负债（万元）</label>
                        <input type="number" id="interestBearingDebt" v-model.number="D" min="0" placeholder="请输入有息负债总额">
                    </div>

                    <div class="input-group">
                        <label for="interest" title="利息费用">利息费用 D（万元）</label>
                        <input type="number" id="interest" v-model.number="interest" min="0" placeholder="请输入利息费用">
                    </div>
                </div>
            </div>

            <!-- WACC计算参数 -->
            <div class="parameter-block">
                <h2>📊 WACC计算参数</h2>

                <div class="input-grid">
                    <div class="input-group">
                        <label for="marketValue">市值 E（万元）</label>
                        <input type="number" id="marketValue" v-model.number="E" min="0" placeholder="请输入公司市值">
                    </div>

                    <div class="input-group">
                        <label for="beta">Beta（β）</label>
                        <input type="number" id="beta" v-model.number="beta" step="0.01" placeholder="请输入 Beta 系数">
                    </div>

                    <div class="input-group">
                        <label for="riskFree" title="无风险利率 r_f（例如 2.6% 输入 0.026）">无风险利率 r_f</label>
                        <input type="number" id="riskFree" v-model.number="rf" step="0.0001" placeholder="请输入无风险利率">
                    </div>

                    <div class="input-group">
                        <label for="erp" title="市场风险溢价 ERP（例如 6% 输入 0.06）">市场风险溢价 ERP</label>
                        <input type="number" id="erp" v-model.number="ERP" step="0.0001" placeholder="请输入市场风险溢价">
                    </div>
                </div>
            </div>

            <!-- ROIC计算参数 -->
            <div class="parameter-block">
                <h2>💰 ROIC计算参数</h2>

                <div class="input-grid">
                    <div class="input-group">
                        <label for="operatingProfit">营业利润（万元）</label>
                        <input type="number" id="operatingProfit" v-model.number="operatingProfit" placeholder="请输入营业利润">
                    </div>

                    <div class="input-group">
                        <label for="parentEquity" title="归属于母公司所有者权益合计">归母所有者权益（万元）</label>
                        <input type="number" id="parentEquity" v-model.number="parentEquity" min="0" placeholder="请输入归母所有者权益">
                    </div>
                </div>
            </div>

            <!-- 统一计算按钮 -->
            <div class="button-group">
                <button @click="calculateAll" class="calculate-btn">
                    🔄 计算全部
                </button>
            </div>
        </div>

        <!-- 结果显示区域 -->
        <div class="results-grid">
            <!-- WACC结果 -->
            <section class="results-section" v-if="calculated && !error">
                <h2>📈 WACC计算结果</h2>

                <div class="summary-cards">
                    <div class="card">
                        <h3>债务成本 r_d（年化）</h3>
                        <p class="value">{{ formatPercent(rd) }}</p>
                        <p class="formula">计算方式：利息费用 ÷ 有息负债</p>
                    </div>
                    
                    <div class="card">
                        <h3>税后债务成本 r_d(1-T)</h3>
                        <p class="value">{{ formatPercent(rdAfterTax) }}</p>
                    </div>
                    
                    <div class="card">
                        <h3>股权成本 r_e（CAPM）</h3>
                        <p class="value">{{ formatPercent(re) }}</p>
                        <p class="formula">r_e = r_f + β × ERP</p>
                    </div>
                    
                    <div class="card">
                        <h3>加权平均资本成本 WACC</h3>
                        <p class="value" style="font-size: 1.8rem;">{{ formatPercent(wacc) }}</p>
                    </div>
                </div>

                <div class="summary-cards">
                    <div class="card">
                        <h3>股权占比 E/(D+E)</h3>
                        <p class="value">{{ equityWeightDisplay }}</p>
                    </div>
                    
                    <div class="card">
                        <h3>债务占比 D/(D+E)</h3>
                        <p class="value">{{ debtWeightDisplay }}</p>
                    </div>
                </div>
            </section>

            <!-- ROIC结果 -->
            <section class="results-section" v-if="roicCalculated && !roicError">
                <h2>📊 ROIC计算结果</h2>

                <div class="summary-cards">
                    <div class="card">
                        <h3>税后营业利润 NOPAT</h3>
                        <p class="value">{{ formatCurrency(calculatedNopat) }}</p>
                        <p class="formula">{{ roicCalculationMethod }}</p>
                    </div>
                    
                    <div class="card">
                        <h3>投入资本 Invested Capital</h3>
                        <p class="value">{{ formatCurrency(calculatedInvestedCapital) }}</p>
                        <p class="formula">{{ investedCapitalMethod }}</p>
                    </div>
                    
                    <div class="card">
                        <h3>投入资本回报率 ROIC</h3>
                        <p class="value" style="font-size: 1.8rem;">{{ formatPercent(roic) }}</p>
                        <p class="formula">ROIC = NOPAT ÷ Invested Capital</p>
                    </div>
                </div>
            </section>

            <!-- ROIC vs WACC比较 -->
            <section class="results-section" v-if="roicComparison.wacc && calculated && roicCalculated">
                <h2>⚖️ ROIC vs WACC 比较分析</h2>

                <div class="summary-cards">
                    <div class="card">
                        <h3>比较结果</h3>
                        <p class="value">{{ roicComparison.result }}</p>
                        <p class="formula">{{ roicComparison.explanation }}</p>
                    </div>

                    <div class="card" :style="getComparisonStyle()">
                        <h3>价值创造能力</h3>
                        <p class="value" style="font-size: 1.5rem;">{{ getValueCreationText() }}</p>
                        <p class="formula">{{ getValueCreationDetail() }}</p>
                    </div>
                </div>
            </section>

            <!-- 错误信息显示 -->
            <section class="results-section" v-if="error || roicError">
                <div class="card" style="background: #fee2e2; color: #991b1b;" v-if="error">
                    <h3>⚠️ WACC输入错误</h3>
                    <p>{{ error }}</p>
                </div>
                
                <div class="card" style="background: #fee2e2; color: #991b1b; margin-top: 20px;" v-if="roicError">
                    <h3>⚠️ ROIC输入错误</h3>
                    <p>{{ roicError }}</p>
                </div>
            </section>
        </div>

        <!-- 说明区域 -->
        <section class="explanation-section">
            <h2>💡 模型说明</h2>
                
                <div class="explanation-content">
                    <h3>什么是WACC？</h3>
                    <p>加权平均资本成本（WACC）是企业各种资本成本的加权平均值，反映了企业筹集资金的平均成本。它是企业投资决策的重要参考指标，简单来说就是企业使用资金的平均成本。</p>

                    <h3>什么是ROIC？</h3>
                    <p>投入资本回报率（ROIC，Return on Invested Capital）是衡量企业运用投入资本创造利润能力的指标。它反映了企业每投入一元资本能够产生多少税后营业利润，是评估企业运营效率和投资回报的重要指标。</p>

                    <h3>ROIC vs WACC 价值创造判断：</h3>
                    <div class="formula">
                        <ul>
                            <li><strong>ROIC > WACC</strong>: 创造价值，投资回报高于资本成本</li>
                            <li><strong>ROIC = WACC</strong>: 维持价值，投资回报等于资本成本</li>
                            <li><strong>ROIC < WACC</strong>: 损害价值，投资回报低于资本成本</li>
                        </ul>
                    </div>

                    <h3>📝 公共参数说明（所有计算都需要用到）</h3>
                    <ul>
                        <li><strong>利润总额</strong>: 企业在缴纳所得税前的利润，在利润表中可以查到</li>
                        <li><strong>所得税费用</strong>: 企业实际缴纳的所得税金额，在利润表中可以查到</li>
                        <li><strong>有息负债（D）</strong>: 公司需要支付利息的债务总和，包括短期借款、一年内到期的非流动负债、长期借款、应付债券等</li>
                        <li><strong>利息费用</strong>: 企业因借款而支付的利息，在利润表中可以查到</li>
                    </ul>

                    <h3>📊 WACC计算专用参数</h3>
                    <div class="formula">
                        <p><strong>WACC计算公式：</strong></p>
                        <p><strong>WACC = E/(D+E) × r_e + D/(D+E) × r_d × (1-T)</strong></p>
                        <p>其中：</p>
                        <ul>
                            <li><strong>市值（E）</strong>: 公司股票的市场价值，也就是公司总市值</li>
                            <li><strong>Beta（β）</strong>: 股票相对于市场的波动性，反映股票风险的指标</li>
                            <li><strong>无风险利率（r_f）</strong>: 通常采用国债收益率，是没有风险的投资回报率</li>
                            <li><strong>市场风险溢价（ERP）</strong>: 市场整体收益超过无风险收益的部分，反映市场平均风险回报</li>
                            <li><strong>股权成本（r_e）</strong>: 使用CAPM模型计算，公式为 r_e = r_f + β × ERP</li>
                            <li><strong>债务成本（r_d）</strong>: 利息费用除以有息负债，反映企业借款的成本</li>
                            <li><strong>企业所得税率（T）</strong>: 所得税费用除以利润总额，反映企业的税负水平</li>
                        </ul>
                    </div>

                    <h3>💰 ROIC计算专用参数</h3>
                    <div class="formula">
                        <p><strong>ROIC计算公式：</strong></p>
                        <p><strong>ROIC = NOPAT ÷ Invested Capital</strong></p>
                        <p>其中：</p>
                        <ul>
                            <li><strong>营业利润</strong>: 企业主营业务产生的利润，在利润表中可以查到</li>
                            <li><strong>归母所有者权益</strong>: 归属于母公司所有者权益合计，在资产负债表中可以查到</li>
                            <li><strong>税后营业利润（NOPAT）</strong>: (营业利润 + 利息支出) × (1 - 税率)，反映企业经营活动的税后利润</li>
                            <li><strong>投入资本（Invested Capital）</strong>: 归母所有者权益 + 有息负债，反映企业实际投入的资本总额</li>
                        </ul>
                    </div>

                    <h3>💡 小白易懂说明</h3>
                    <p><strong>简单来说：</strong></p>
                    <ul>
                        <li><strong>WACC</strong> 是企业使用资金的平均成本，就像你借钱要付利息一样，企业使用股东和债权人的钱也有成本</li>
                        <li><strong>ROIC</strong> 是企业使用投入资本赚取利润的能力，就像你投资100元能赚多少钱</li>
                        <li><strong>当ROIC > WACC时</strong>，说明企业用别人的钱赚钱的能力超过了成本，是在创造价值</li>
                        <li><strong>当ROIC < WACC时</strong>，说明企业用别人的钱赚钱的能力低于成本，是在损害价值</li>
                    </ul>

                    <h3>⚠️ 注意事项：</h3>
                    <ul>
                        <li>所有金额单位为<strong>万元</strong></li>
                        <li>利润总额应大于所得税费用，确保税率在合理范围内</li>
                        <li>如果利润总额为0或负数，则无法计算有效税率</li>
                        <li>市值和有息负债不能同时为0，否则无法计算WACC</li>
                        <li>投入资本必须大于0才能计算有效的ROIC</li>
                        <li>ROIC是年度指标，反映的是企业一年期的投资回报能力</li>
                        <li>填写数据时，建议参考企业最新的财务报表</li>
                    </ul>
                </div>
            </section>
    </main>

    <footer class="footer">
        <p>© 2024 WACC 计算器 | 数据仅供参考，投资需谨慎</p>
    </footer>
</div>

<script src="wacc.js"></script>
</body>
</html>