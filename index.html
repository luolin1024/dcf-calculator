<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公司估值计算器 - DCF模型</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div id="app">
    <header class="header">
        <h1>📊 公司估值计算器</h1>
        <p>基于现金流折现模型 (DCF)</p>
    </header>

    <main class="container">
        <!-- 输入参数区域 -->
        <section class="input-section">
            <h2>🔧 计算参数</h2>

            <div class="input-grid">
                <div class="input-group">
                    <label for="initialCashFlow">初始自由现金流 (万元)</label>
                    <input type="number" id="initialCashFlow" v-model.number="initialCashFlow" placeholder="例如：1000">
                </div>

                <div class="input-group">
                    <label for="growthRate">增长率 (%)</label>
                    <input type="number" id="growthRate" v-model.number="growthRate" step="0.1" placeholder="例如：10">
                </div>

                <div class="input-group">
                    <label for="discountRate">折现率 (%)</label>
                    <input type="number" id="discountRate" v-model.number="discountRate" step="0.1" placeholder="例如：12">
                </div>

                <div class="input-group">
                    <label for="years">预测年限</label>
                    <input type="number" id="years" v-model.number="years" placeholder="例如：5">
                </div>

                <div class="input-group">
                    <label for="terminalGrowth">永续增长率 (%)</label>
                    <input type="number" id="terminalGrowth" v-model.number="terminalGrowth" step="0.1" placeholder="例如：3">
                </div>
            </div>

            <button @click="calculateDCF" class="calculate-btn">开始计算</button>
        </section>

        <!-- 结果显示区域 -->
        <section class="results-section" v-if="results.calculated">
            <h2>📈 计算结果</h2>

            <div class="summary-cards">
                <div class="card">
                    <h3>公司估值</h3>
                    <p class="value">{{ formatCurrency(results.companyValue) }} 万元</p>
                </div>
                <div class="card">
                    <h3>经营价值</h3>
                    <p class="value">{{ formatCurrency(results.operatingValue) }} 万元</p>
                </div>
                <div class="card">
                    <h3>终值</h3>
                    <p class="value">{{ formatCurrency(results.terminalValue) }} 万元</p>
                </div>
            </div>

            <!-- 在表格上方添加说明 -->
            <div class="table-container">
                <h3>年度现金流明细
                    <span class="info-icon" title="点击查看公式说明" @click="showFormulaHelp = !showFormulaHelp">ℹ️</span>
                </h3>

                <!-- 公式帮助提示 -->
                <div v-if="showFormulaHelp" class="formula-help">
                    <h4>计算公式说明：</h4>
                    <ul>
                        <li><strong>自由现金流</strong> = 初始现金流 × (1 + 增长率)<sup>年份</sup></li>
                        <li><strong>折现因子</strong> = (1 + 折现率)<sup>年份</sup></li>
                        <li><strong>现值</strong> = 自由现金流 ÷ 折现因子</li>
                        <li><strong>累计现值</strong> = 当前年及之前所有年份的现值之和</li>
                        <li><strong>终值</strong> = [最后一年现金流 × (1 + 永续增长率)] ÷ (折现率 - 永续增长率)</li>
                    </ul>
                </div>

                <table>
                    <thead>
                    <tr>
                        <th>年份</th>
                        <th>自由现金流</th>
                        <th>折现因子</th>
                        <th>现值</th>
                        <th>累计现值</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="year in results.yearlyData" :key="year.year"
                        :class="{ 'terminal-row': year.isTerminal }">
                        <td>{{ year.year }}</td>
                        <td>{{ formatCurrency(year.cashFlow) }}</td>
                        <td>{{ year.discountFactor.toFixed(4) }}</td>
                        <td>{{ formatCurrency(year.presentValue) }}</td>
                        <td>{{ formatCurrency(year.cumulativePV) }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- 图表展示 -->
            <div class="chart-container">
                <h3>现金流趋势</h3>
                <canvas id="cashFlowChart" ref="chartCanvas"></canvas>
            </div>
        </section>

        <!-- 说明区域 -->
        <section class="explanation-section">
            <h2>💡 DCF模型说明</h2>
            <!-- 在 explanation-section 中替换或添加以下内容 -->
            <div class="explanation-content">
                <h3>什么是经营价值？</h3>
                <p>经营价值是指公司在预测期内（如前5年）所有自由现金流的现值总和。它反映了公司核心业务在可预测期间内创造的价值，不包括终值。</p>

                <h3>DCF计算分解：</h3>
                <div class="formula">
                    <p><strong>公司总价值 = 经营价值 + 终值现值</strong></p>
                    <p>经营价值 = ∑ [第1年到第n年的现金流现值]</p>
                    <p>终值现值 = 终值 / (1 + 折现率)^n</p>
                </div>

                <h3>终值计算详解</h3>
                <div class="terminal-value-explanation">
                    <p>终值代表预测期结束后公司永续经营阶段的价值，使用戈登增长模型计算：</p>

                    <div class="formula">
                        <p><strong>终值 = [第n年现金流 × (1 + 永续增长率)] ÷ (折现率 - 永续增长率)</strong></p>
                        <p>其中：</p>
                        <ul>
                            <li><strong>第n年现金流</strong>：预测期最后一年的自由现金流</li>
                            <li><strong>永续增长率</strong>：公司长期稳定的增长率，通常接近GDP增长率</li>
                            <li><strong>折现率</strong>：投资者的要求回报率，反映风险水平</li>
                        </ul>
                    </div>

                    <div class="formula-example">
                        <h4>计算示例：</h4>
                        <p>假设：</p>
                        <ul>
                            <li>第5年现金流：1,610.51万元</li>
                            <li>永续增长率：3%</li>
                            <li>折现率：12%</li>
                        </ul>
                        <p>终值 = 1,610.51 × (1 + 3%) ÷ (12% - 3%) = 1,658.83 ÷ 9% = 18,431.44万元</p>
                        <p>终值现值 = 18,431.44 ÷ (1 + 12%)^5 = 18,431.44 ÷ 1.7623 = 10,459.22万元</p>
                    </div>
                </div>

                <h3>核心公式：</h3>
                <div class="formula">
                    <p>公司价值 = ∑ [第t年现金流 / (1 + 折现率)^t] + 终值 / (1 + 折现率)^n</p>
                </div>

                <h3>参数说明：</h3>
                <ul>
                    <li><strong>自由现金流</strong>: 公司经营活动产生的可自由支配的现金</li>
                    <li><strong>增长率</strong>: 预期现金流的年均增长率</li>
                    <li><strong>折现率</strong>: 反映投资风险的预期回报率</li>
                    <li><strong>永续增长率</strong>: 预测期后的长期稳定增长率，通常为2%-4%</li>
                </ul>

                <h3>注意事项：</h3>
                <ul>
                    <li>永续增长率必须小于折现率，否则公式不成立</li>
                    <li>永续增长率通常不应超过长期GDP增长率</li>
                    <li>终值通常占公司总价值的很大比例（50%-70%）</li>
                    <li>高增长公司的终值比例可能更高</li>
                </ul>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>© 2024 公司估值计算器 |
            <a :href="githubRepo" target="_blank">GitHub仓库</a> |
            数据仅供参考，投资需谨慎
        </p>
    </footer>
</div>

<script src="app.js"></script>
</body>
</html>